---
import { Picture } from "@astrojs/image/components";
import processMarkdown from "@utils/markdown";
import { format } from "date-fns";

const { data, slug, body} = Astro.props
---

<style lang="scss">
	article {
		padding: 10px;
		background: var.$primary;
		border-radius: 10px;
		color: var.$secondary;
		position: relative;

		:global(picture) {
			width: 100%;
			overflow: hidden;
			
		}

		&:hover {
			background: var.$secondary;
			color: var.$white;
		}
	}

	.excerpt {
		@include mixins.clip_lines(6);

		:global(a) {
			text-decoration: none;
			pointer-events: none;
			color: inherit;
		}
	}

	.image {
		width: 100%;
		height: 60vw;
		max-height: 300px;
		object-fit: cover;
		border-radius: 10px;
	}

	.date {
		font-family: var.$font_headings;
		font-weight: 600;
	}

	.title {
		color: inherit;

		a {
			&:before {
				content: '';
				position: absolute;
				top: 0;
				left: 0;
				right: 0;
				bottom: 0;
			}

			&:hover {
				text-decoration: none;
			}
		}
	}

	@media(min-width: 30em) {
		article {
			display: flex;
			padding: 20px;

			:global(picture) {
				height: 100%;
				width: 40%;
				max-width: 300px;
				flex-shrink: 0;
				margin-right: 20px;
				max-height: 300px;
				min-height: 100%;
			}
		}

		.content {
			align-self: flex-end;
		}

		.image {
			// max-height: unset;
			height: 100%;
		}

		.title {
			margin-top: 5px;
		}
	}
</style>

<article>
	<Picture
		class="image"
		src={data.preview_image}
		alt=""
		widths={[200, 400]}
		aspectRatio="4:5"
		formats={["avif", "webp", "png"]}
	/>
	<div class="content">
		<h3 class="title">
			<a href={`/blog/${slug}`}>{data.title}</a>
		</h3>
		<p class="date">{format(data.date, 'dd MMM yyyy')}</p>
		<div class="excerpt" set:html={processMarkdown(body)} />
	</div>
</article>