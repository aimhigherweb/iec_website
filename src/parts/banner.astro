---
import { Picture } from "@astrojs/image/components";
import CTAButtons from "@parts/cta.astro";

const { image, video, cta } = Astro.props.content;
---

<style lang="scss">
	section {
		position: relative;

		&:before {
			position: absolute;
			width: 100vw;
			content: "";
			background: rgba(var.$black, 0.6);
			display: block;
			height: 100%;
			z-index: 3;
		}
	}

	.video {
		position: relative;
		width: 100vw;
		height: calc(9 / 16 * 100vw);
		z-index: 2;
		min-height: 300px;
		min-width: calc(16 / 9 * 300px);
	}

	video {
		display: none;
	}

	.image,
	video,
	.background {
		position: absolute;
		width: 100%;
		height: 100%;
		max-width: 100%;
		max-height: 100%;
		object-fit: cover;
	}

	.background {
		filter: blur(15px);
	}

	@keyframes fade {
		0% {
			opacity: 1;
		}
		100% {
			opacity: 0;
		}
	}

	.image {
		z-index: 2;
	}

	.ctas {
		position: absolute;
		top: 50%;
		width: 100vw;
		justify-content: center;
		transform: translateY(-50%) translateX(-50%);
		z-index: 5;
		font-size: 1.7em;
		left: 50%;
		margin: 0;
		font-size: 1.5em;
	}

	@media (min-width: 40em) {
		video {
			display: block;
		}

		.image {
			animation-fill-mode: forwards;
			animation-name: fade;
			animation-duration: 1s;
			animation-delay: 2s;
			animation-timing-function: linear;

			@media (prefers-reduced-motion: reduce) {
				animation: none;
			}
		}

		.video {
			max-height: 80vh;
			max-width: calc(16 / 9 * 80vh);
			margin: 0 auto;
		}
	}
</style>

<section>
	<Picture
		src={image}
		alt=""
		widths={[400, 800, 1200, 2000]}
		aspectRatio={16 / 9}
		formats={["avif", "webp", "jpg"]}
		fit={"cover"}
		position={"centre"}
		class="background"
	/>
	<div class="video">
		<Picture
			src={image}
			alt=""
			widths={[400, 800, 1200, 2000]}
			aspectRatio={16 / 9}
			formats={["avif", "webp", "jpg"]}
			fit={"cover"}
			position={"centre"}
			class="image"
		/>
		<video autoplay loop muted>
			<source src={video} type="video/mp4" />
			<p>Your browser doesn't support HTML video.</p>
		</video>
	</div>
	<CTAButtons class="ctas" {cta} />
</section>
